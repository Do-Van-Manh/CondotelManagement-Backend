Workflow,Refund Workflow Tests - Complete UI-Based Test Cases,,,,
Test requirement,"Test all possible scenarios for refund workflow of Condotel Management system end-to-end on Front-end UI, including user interactions, button clicks, form submissions, navigation flows, error messages display, and complete refund journeys visible on screen",,,,
Number of TCs,35,,,,
,,,,,
Testing Round Summary,,,,,
,Passed,Failed,Pending,N/A,
Round 1,0,0,35,0,
Round 2,0,0,35,0,
Round 3,0,0,35,0,
,,,,,
TestcaseID,Function Name,Test Case Description,Test Case Procedure,Expected Results,Pre-conditions
,,,,,
Scenario A: Tenant Request Refund from Booking Detail (8 test cases),,,,,
WF-REFUND-001,RequestRefund,Cancel Booking and Request Refund - Valid Confirmed Booking,"1. Open browser and login the system with Tenant role
2. Navigate to ""Lịch sử đặt phòng"" page by clicking on menu item
3. Click on a booking card with status ""Đã xác nhận""
4. Observe booking detail page appears
5. Scroll to find ""❌ Hủy đặt phòng"" button
6. Click ""❌ Hủy đặt phòng"" button
7. Observe confirmation dialog appears with message: ""Bạn có chắc chắn muốn hủy đặt phòng này? Nếu hủy trong vòng 2 ngày, bạn có thể yêu cầu hoàn tiền.""
8. Click ""OK"" in confirmation dialog
9. Observe button text changes to ""Đang hủy...""
10. If booking was cancelled within 2 days, observe second confirmation dialog appears: ""Đã hủy đặt phòng thành công! Bạn có muốn điền thông tin để yêu cầu hoàn tiền ngay bây giờ không?""
11. Click ""OK"" to navigate to refund request page
12. Observe page navigation","1. Booking detail page displays booking information
2. Status badge shows ""Đã xác nhận"" (green badge)
3. ""❌ Hủy đặt phòng"" button is visible and enabled
4. First confirmation dialog appears with correct message
5. After clicking ""OK"", button shows ""Đang hủy...""
6. If within 2 days, second confirmation dialog appears
7. After clicking ""OK"", user is redirected to refund request page (/request-refund/{bookingId})
8. Booking status badge changes to ""Đã hủy"" (red badge)","User is logged in as Tenant role. Booking exists with Status = """"Đã xác nhận"""". Booking was created within 2 days. Booking has totalPrice > 0"
WF-REFUND-002,RequestRefund,Request Refund Directly - Cancelled Booking,"1. Open browser and login the system with Tenant role
2. Navigate to ""Lịch sử đặt phòng"" page
3. Click on a booking card with status ""Đã hủy"" that was cancelled within 2 days
4. Observe booking detail page appears
5. Scroll to find ""💰 Yêu cầu hoàn tiền"" button
6. Click ""💰 Yêu cầu hoàn tiền"" button
7. Observe page navigation","1. Booking detail page displays booking information
2. Status badge shows ""Đã hủy"" (red badge)
3. ""💰 Yêu cầu hoàn tiền"" button is visible and enabled
4. After clicking button, user is redirected to refund request page (/request-refund/{bookingId})
5. Refund request page displays booking information","User is logged in as Tenant role. Booking exists with Status = """"Đã hủy"""". Booking was cancelled within 2 days from creation date. Booking has totalPrice > 0"
WF-REFUND-003,RequestRefund,Submit Refund Request - Valid Bank Information,"1. On refund request page (/request-refund/{bookingId}), observe page content
2. Review ""Thông tin Booking"" card showing booking details (Căn hộ, Ngày đặt, Check-in / Check-out, Số tiền hoàn)
3. Scroll to ""Thông tin Tài khoản Ngân hàng"" form section
4. Review blue info box with text: ""Vui lòng cung cấp thông tin tài khoản ngân hàng để Admin chuyển khoản hoàn tiền cho bạn. Thời gian xử lý: 1-3 ngày làm việc.""
5. Select bank name from dropdown (e.g., ""Vietcombank (VCB)"")
6. Enter account number in ""Số tài khoản"" field (only numbers allowed)
7. Enter account holder name in ""Tên chủ tài khoản"" field (automatically converts to uppercase, no accents)
8. Click ""Gửi yêu cầu hoàn tiền"" button
9. Observe button state changes to ""Đang xử lý..."" with spinner icon
10. Observe success message appears","1. Refund request page displays heading ""Yêu cầu Hoàn tiền""
2. ""Thông tin Booking"" card shows correct booking details
3. ""Số tiền hoàn"" displays in red color with large font (format: XXX,XXX đ)
4. Form fields are visible: ""Tên Ngân hàng"" (dropdown), ""Số tài khoản"" (text input), ""Tên chủ tài khoản"" (text input)
5. All fields are marked with red asterisk (*) indicating required
6. Bank dropdown shows list of Vietnamese banks (Vietcombank, MBBank, Techcombank, etc.)
7. Account number field only accepts numeric input
8. Account holder name automatically converts to uppercase
9. After clicking submit, button shows ""Đang xử lý..."" with spinner
10. Success message appears in green box: ""Yêu cầu hoàn tiền đã được gửi thành công. Admin sẽ xử lý trong vòng 1-3 ngày làm việc.""
11. Page automatically redirects to ""/my-bookings"" after 2 seconds",User is on refund request page. Booking is in valid state for refund. All form fields are filled correctly
WF-REFUND-004,RequestRefund,Submit Refund Request - Missing Bank Information,"1. On refund request page (/request-refund/{bookingId})
2. Leave ""Tên Ngân hàng"" dropdown empty
3. Leave ""Số tài khoản"" field empty
4. Leave ""Tên chủ tài khoản"" field empty
5. Click ""Gửi yêu cầu hoàn tiền"" button
6. Observe error message appears","1. Browser alert appears with message: ""Vui lòng điền đầy đủ thông tin ngân hàng""
2. Form submission is prevented
3. User remains on refund request page
4. Form fields remain empty",User is on refund request page. Form fields are empty
WF-REFUND-005,RequestRefund,Request Refund - Booking Already Refunded,"1. Open browser and login the system with Tenant role
2. Navigate to ""Lịch sử đặt phòng"" page
3. Click on a booking card that has already been refunded (status = ""Đã hủy"" and has refund request with status ""Completed"" or ""Refunded"")
4. Observe booking detail page
5. Check if ""💰 Yêu cầu hoàn tiền"" button is visible","1. Booking detail page displays booking information
2. Status badge shows ""Đã hủy"" (red badge)
3. ""💰 Yêu cầu hoàn tiền"" button is NOT visible (booking already has refund request completed)
4. User cannot request refund again","User is logged in as Tenant role. Booking exists with Status = """"Đã hủy"""". Booking has existing RefundRequest with Status = """"Completed"""" or """"Refunded"""""
WF-REFUND-006,RequestRefund,Request Refund - Booking Cancelled Before Payment,"1. Open browser and login the system with Tenant role
2. Navigate to ""Đặt phòng của tôi"" page
3. Click on a booking card with status ""Đã hủy"" that was cancelled before payment 
4. Observe booking detail page
5. Check if ""💰 Yêu cầu hoàn tiền"" button is visible
6. If button is visible, click it and observe error message","1. Booking detail page displays booking information
2. Status badge shows ""Đã hủy"" (red badge)
3. ""💰 Yêu cầu hoàn tiền"" button is NOT visible OR
4. If button is visible and clicked, error message appears: ""Booking này đã bị hủy thanh toán (chưa thanh toán). Không thể yêu cầu hoàn tiền cho booking chưa thanh toán.""","User is logged in as Tenant role. Booking exists with Status = """"Đã hủy"""". Booking has totalPrice = 0 or null (cancelled before payment)"
WF-REFUND-007,RequestRefund,Request Refund - Booking Outside Time Limit (Confirmed),"1. Open browser and login the system with Tenant role
2. Navigate to ""Lịch sử đặt phòng"" page
3. Click on a booking card with status ""Đã xác nhận"" that is less than 2 days before check-in date
4. Observe booking detail page
5. Try to cancel booking and request refund
6. Observe error message","1. Booking detail page displays booking information
2. Status badge shows ""Đã xác nhận"" (green badge)
3. If user tries to cancel, error message appears: ""Refund is only available when cancelling at least 2 days before check-in.""
4. User cannot request refund","User is logged in as Tenant role. Booking exists with Status = """"Đã xác nhận"""". Booking check-in date is less than 2 days away"
WF-REFUND-008,RequestRefund,Request Refund - Booking Outside Time Limit (Completed),"1. Open browser and login the system with Tenant role
2. Navigate to ""Lịch sử đặt phòng"" page
3. Click on a booking card with status ""Hoàn thành"" that was completed more than 7 days ago
4. Observe booking detail page
5. Try to request refund
6. Observe error message","1. Booking detail page displays booking information
2. Status badge shows ""Hoàn thành"" (green badge)
3. If user tries to request refund, error message appears: ""Refund is only available within 7 days after check-out date.""
4. User cannot request refund","User is logged in as Tenant role. Booking exists with Status = """"Hoàn thành"""". Booking endDate was more than 7 days ago"
,,,,,
Scenario B: Admin Process Refund Requests (12 test cases),,,,,
WF-REFUND-009,AdminRefund,View Refund Requests List - All Statuses,"1. Open browser and login the system with Admin role
2. Navigate to ""Quản lý Yêu cầu Hoàn tiền"" page (/admin/refunds) by clicking on menu item
3. Observe page content
4. Review refund requests table
5. Check table columns and data displayed","1. Page displays heading ""Quản lý Yêu cầu Hoàn tiền""
2. Description text appears: ""Quản lý các yêu cầu hủy phòng và hoàn tiền từ khách hàng""
3. Search and filter section appears with fields: ""Tìm kiếm"", ""Trạng thái"", ""Từ ngày"", ""Đến ngày"", ""Xóa bộ lọc"" button
4. Table displays with columns: ""Mã Đơn"", ""Khách hàng"", ""Số tiền hoàn"", ""Thông tin nhận tiền"", ""Quét mã hoàn tiền"", ""Trạng thái"", ""Hành động""
5. Each row shows refund request information
6. Status badges display: ""⏳ Đang chờ"" (yellow), ""✅ Đã hoàn tiền (Thủ công)"" (green), ""✅ Đã hoàn tiền (PayOS)"" (green), ""❌ Đã từ chối"" (red)
7. For ""Pending"" status requests, action buttons are visible: ""💰 Hoàn tự động"", ""✅ Xác nhận thủ công"", ""❌ Từ chối""
8. For completed/refunded/rejected requests, text ""Đã xử lý xong"" appears instead of buttons",User is logged in as Admin role. Refund requests exist in database
WF-REFUND-010,AdminRefund,Filter Refund Requests - By Status,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Click on ""Trạng thái"" dropdown
3. Select ""⏳ Chưa hoàn tiền"" option
4. Observe table updates
5. Select ""✅ Đã hoàn tiền"" option
6. Observe table updates
7. Select ""Tất cả"" option
8. Observe table updates","1. Dropdown shows options: ""Tất cả"", ""⏳ Chưa hoàn tiền"", ""✅ Đã hoàn tiền""
2. When ""⏳ Chưa hoàn tiền"" is selected, table only shows requests with status ""Pending""
3. When ""✅ Đã hoàn tiền"" is selected, table shows requests with status ""Completed"" or ""Refunded""
4. When ""Tất cả"" is selected, table shows all requests regardless of status
5. Table updates automatically when filter changes",User is on admin refund page. Multiple refund requests exist with different statuses
WF-REFUND-011,AdminRefund,Search Refund Requests - By Booking ID,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Click on ""Tìm kiếm"" input field
3. Enter booking ID (e.g., ""33"")
4. Observe table updates
5. Clear search field
6. Observe table updates","1. Search input accepts text input
2. Table filters to show only requests matching the search term (by booking ID, customer name, or email)
3. Filtering happens automatically with debounce (500ms delay)
4. When search field is cleared, table shows all requests again",User is on admin refund page. Multiple refund requests exist
WF-REFUND-012,AdminRefund,Filter Refund Requests - By Date Range,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Click on ""Từ ngày"" date picker
3. Select a start date
4. Click on ""Đến ngày"" date picker
5. Select an end date
6. Observe table updates
7. Click ""Xóa bộ lọc"" button
8. Observe table updates","1. Date pickers allow date selection
2. When dates are selected, table filters to show only requests within the date range
3. Table updates automatically when dates change
4. When ""Xóa bộ lọc"" is clicked, all filters are reset (search term, status, dates)
5. Table shows all requests again",User is on admin refund page. Multiple refund requests exist with different dates
WF-REFUND-013,AdminRefund,View QR Code for Refund - Compact View,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""Pending"" that has bank information
3. Observe ""Quét mã hoàn tiền"" column
4. Check if QR code image is displayed
5. Observe QR code appearance","1. For ""Pending"" requests with bank info, QR code image appears in ""Quét mã hoàn tiền"" column
2. QR code is displayed in compact size (approximately 112px x 112px)
3. Text ""🔍 Phóng to"" appears below QR code
4. QR code image loads from VietQR API
5. If QR code fails to load, image retries after 1 second","User is on admin refund page. Refund request exists with status ""Pending"" and has bank information"
WF-REFUND-014,AdminRefund,View QR Code for Refund - Full Size Modal,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""⏳ Chưa hoàn tiền"" that has bank information
3. Click on QR code image in ""Quét mã hoàn tiền"" column
4. Observe modal appears
5. Review modal content
6. Click ""Đóng"" button
7. Observe modal closes","1. Modal appears with dark overlay background
2. Modal displays heading: ""Hoàn tiền cho {customerName}""
3. Large QR code image is displayed 
4. Information section shows: ""Số tiền hoàn:"" (formatted as XXX,XXX đ), ""Nội dung:"" (shows ""Hoan tien BOOK-XXX"")
5. ""Đóng"" button appears at bottom
6. When ""Đóng"" is clicked, modal closes and overlay disappears
7. Page content becomes accessible again","User is on admin refund page. Refund request exists with status ""⏳ Chưa hoàn tiền"" and has bank information. QR code is visible"
WF-REFUND-015,AdminRefund,Process Refund - Auto Refund (PayOS),"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""Pending""
3. Click ""💰 Hoàn tự động"" button
4. Observe confirmation modal appears
5. Review modal content
6. Enter optional reason in ""Lý do hoàn tiền"" textarea
7. Click ""Hoàn tiền tự động"" button
8. Observe button state changes
9. Observe success message
10. Observe table updates","1. Confirmation modal appears with heading ""Hoàn tiền tự động?""
2. Modal displays message: ""Bạn có muốn hoàn tiền tự động cho khách hàng qua Cas Transfer API? Hệ thống sẽ tự động chuyển tiền vào tài khoản ngân hàng của khách hàng.""
3. Textarea appears for ""Lý do hoàn tiền (tùy chọn)""
4. Buttons appear: ""Hủy bỏ"" (gray), ""Hoàn tiền tự động"" (green)
5. After clicking ""Hoàn tiền tự động"", button shows ""Đang xử lý...""
6. Success alert appears: ""Hoàn tiền tự động thành công!""
7. Modal closes
8. Table refreshes automatically
9. Refund request status changes to ""✅ Đã hoàn tiền (PayOS)"" (green badge)
10. Action buttons disappear, replaced with ""Đã xử lý xong"" text","User is on admin refund page. Refund request exists with status ""Pending"". Admin has permission to process refunds"
WF-REFUND-016,AdminRefund,Process Refund - Manual Confirmation,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""Pending""
3. Click ""✅ Xác nhận thủ công"" button
4. Observe confirmation modal appears
5. Review modal content
6. Observe QR code in modal
7. Review bank information displayed
8. Click ""Xác nhận ngay"" button
9. Observe button state changes
10. Observe success message
11. Observe table updates","1. Confirmation modal appears with heading ""Xác nhận đã chuyển khoản?""
2. Modal displays message: ""Bạn xác nhận rằng đã chuyển tiền thành công cho khách hàng này qua ngân hàng? Hành động này sẽ cập nhật trạng thái đơn hàng thành \""Đã hoàn tiền\"".""
3. Bank information section appears showing: ""Khách hàng:"", ""Số tiền:"", ""Ngân hàng:"", ""Số tài khoản:"", ""Chủ tài khoản:""
4. QR code image appears in modal (print size, approximately 256px x 256px)
5. Text ""Quét mã QR để chuyển khoản"" appears below QR code
6. Buttons appear: ""Hủy bỏ"" (gray), ""Xác nhận ngay"" (green)
7. After clicking ""Xác nhận ngay"", button shows ""Đang xử lý...""
8. Success alert appears: ""Đã xác nhận chuyển tiền thủ công thành công!""
9. Modal closes
10. Table refreshes automatically
11. Refund request status changes to ""✅ Đã hoàn tiền (Thủ công)"" (green badge)
12. Action buttons disappear, replaced with ""Đã xử lý xong"" text","User is on admin refund page. Refund request exists with status ""Pending"" and has bank information. Admin has permission to process refunds"
WF-REFUND-017,AdminRefund,Reject Refund Request,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""Pending""
3. Click ""❌ Từ chối"" button
4. Observe rejection modal appears
5. Review modal content
6. Enter reason in ""Lý do từ chối"" textarea
7. Click ""Xác nhận từ chối"" button
8. Observe button state changes
9. Observe success message
10. Observe table updates","1. Rejection modal appears with heading ""❌ Từ chối yêu cầu hoàn tiền""
2. Modal displays message: ""Bạn có chắc chắn muốn từ chối yêu cầu hoàn tiền này? Vui lòng nhập lý do từ chối.""
3. Textarea appears for ""Lý do từ chối"" 
4. Textarea is marked as required (red asterisk)
5. Buttons appear: ""Hủy"" , ""Xác nhận từ chối""
6. ""Xác nhận từ chối"" button is disabled if textarea is empty
7. After entering reason and clicking ""Xác nhận từ chối"", button shows ""Đang xử lý...""
8. Success alert appears: ""Đã từ chối yêu cầu hoàn tiền thành công!""
9. Modal closes
10. Table refreshes automatically
11. Refund request status changes to ""❌ Đã từ chối""
12. Action buttons disappear, replaced with ""Đã xử lý xong"" text","User is on admin refund page. Refund request exists with status ""Pending"". Admin has permission to process refunds"
WF-REFUND-018,AdminRefund,Reject Refund Request - Missing Reason,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""Pending""
3. Click ""❌ Từ chối"" button
4. Observe rejection modal appears
5. Leave ""Lý do từ chối"" textarea empty
6. Try to click ""Xác nhận từ chối"" button
7. Observe button state
8. Enter reason in textarea
9. Observe button state changes","1. Rejection modal appears
2. ""Lý do từ chối"" textarea is empty
3. ""Xác nhận từ chối"" button is disabled (grayed out, not clickable)
4. Button text shows ""Xác nhận từ chối"" but cursor shows ""not-allowed""
5. After entering text in textarea, button becomes enabled (red color, clickable)
6. User can now click button to submit rejection","User is on admin refund page. Refund request exists with status ""Pending"". Rejection modal is open"
WF-REFUND-019,AdminRefund,View Refund Request - No Bank Information,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""Pending"" that does NOT have bank information
3. Observe ""Thông tin nhận tiền"" column
4. Observe ""Quét mã hoàn tiền"" column
5. Check action buttons availability","1. ""Thông tin nhận tiền"" column shows text: ""Chưa có thông tin"" (gray, italic)
2. ""Quét mã hoàn tiền"" column shows text: ""--"" (gray, italic)
3. ""💰 Hoàn tự động"" button is still visible and enabled
4. ""✅ Xác nhận thủ công"" button is still visible and enabled (but QR code may not be available)
5. ""❌ Từ chối"" button is still visible and enabled","User is on admin refund page. Refund request exists with status ""Pending"" but does NOT have bank information"
WF-REFUND-020,AdminRefund,View Refund Request - Completed Status,"1. On ""Quản lý Yêu cầu Hoàn tiền"" page
2. Find a refund request with status ""✅ Đã hoàn tiền (Thủ công)"" or ""✅ Đã hoàn tiền (PayOS)""
3. Observe table row
4. Check action buttons
5. Check QR code visibility","1. Status badge shows ""✅ Đã hoàn tiền (Thủ công)"" (green) or ""✅ Đã hoàn tiền (PayOS)"" (green)
2. ""Hành động"" column shows text: ""Đã xử lý xong"" (gray, italic)
3. Action buttons (""💰 Hoàn tự động"", ""✅ Xác nhận thủ công"", ""❌ Từ chối"") are NOT visible
4. QR code is NOT visible in ""Quét mã hoàn tiền"" column (shows ""--"")
5. User cannot perform any actions on this request","User is on admin refund page. Refund request exists with status ""Completed"" or ""Refunded"""
,,,,,
Scenario C: Refund Payment Flow via PayOS (5 test cases),,,,,
WF-REFUND-021,RefundPayment,Receive PayOS Refund Link - Customer View,"1. Customer receives PayOS refund payment link (via email or notification)
2. Click on refund payment link
3. Observe PayOS checkout page opens
4. Review payment information displayed
5. Complete payment on PayOS
6. Observe redirect after payment","1. PayOS checkout page opens in browser
2. Payment information displays: amount to receive, booking ID, description
3. Customer can complete payment to receive refund
4. After payment completion, PayOS redirects to application return URL
5. Application redirects to appropriate page based on payment status","Refund request exists with status ""⏳ Chưa hoàn tiền"". PayOS refund payment link has been generated. Customer has access to the link"
WF-REFUND-022,RefundPayment,Refund Payment Success - PayOS Return,"1. Customer completes PayOS refund payment successfully (customer has received money)
2. PayOS redirects to application return URL (/api/payment/payos/return) with status = ""PAID""
3. Application backend processes refund payment return URL
4. Application detects this is refund payment (orderCode format: BookingId * 1000000 + 999999)
5. Application updates RefundRequest status from ""Pending"" to ""Refunded""
6. Application redirects customer to frontend success page
7. Customer observes success page appears in browser
8. Review success page content displayed","1. PayOS redirects to application with status = ""PAID"" and cancel != ""true""
2. Application backend detects this is refund payment (not booking payment)
3. Application updates RefundRequest status from ""Pending"" to ""Refunded""
4. Application redirects customer to /refund-success?bookingId={bookingId}&status=success&orderCode={orderCode}&paymentLinkId={id}
5. Success page displays confirmation message that refund was successful
6. Booking status remains ""Cancelled"" (not changed to ""Refunded"")
7. Refund request status is now ""Refunded"" (visible in admin refund page as ""✅ Đã hoàn tiền (PayOS)"")
8. Voucher UsedCount is rolled back (if voucher was used in original booking)","Customer has completed PayOS refund payment and received money. Payment status is ""PAID"". Return URL is called by PayOS"
WF-REFUND-023,RefundPayment,Refund Payment Cancelled - PayOS Return,"1. Customer cancels PayOS refund payment (does not complete payment, does not receive money)
2. PayOS redirects to application return URL (/api/payment/payos/return) with status = ""CANCELLED""
3. Application backend processes cancelled payment return URL
4. Application detects this is refund payment
5. Application does NOT update RefundRequest status (remains ""Pending"")
6. Application redirects customer to frontend cancel page
7. Customer observes cancel page appears in browser
8. Review cancel page content displayed","1. PayOS redirects to application with status = ""CANCELLED"" or cancel = ""true""
2. Application backend detects this is refund payment
3. Application does NOT update RefundRequest status (remains ""Pending"")
4. Application redirects customer to /refund-cancel?bookingId={bookingId}&status=cancelled&orderCode={orderCode}&paymentLinkId={id}
5. Cancel page displays message that payment was cancelled
6. Refund request status remains ""Pending"" (customer can retry later)
7. Customer can use the same PayOS link again to retry refund payment
8. Admin can still see refund request with status ""Pending"" in admin refund page","Customer has cancelled PayOS refund payment (did not complete, did not receive money). Payment status is ""CANCELLED"". Return URL is called by PayOS"
WF-REFUND-024,RefundPayment,Refund Payment Pending - PayOS Return,"1. Customer initiates PayOS refund payment but payment is still processing (money not yet received)
2. PayOS redirects to application return URL (/api/payment/payos/return) with status = ""PENDING"" or ""PROCESSING""
3. Application backend processes pending payment return URL
4. Application detects this is refund payment
5. Application does NOT update RefundRequest status (remains ""Pending"")
6. Application redirects customer to frontend pending page
7. Customer observes pending page appears in browser
8. Review pending page content displayed","1. PayOS redirects to application with status = ""PENDING"" or ""PROCESSING""
2. Application backend detects this is refund payment
3. Application does NOT update RefundRequest status (remains ""Pending"")
4. Application redirects customer to /refund-pending?bookingId={bookingId}&status=pending&orderCode={orderCode}
5. Pending page displays message that payment is still processing
6. Refund request status remains ""Pending""
7. Customer should wait for payment to complete or check status later
8. Customer may need to check PayOS or wait for webhook to update status to ""Refunded""
9. Admin can still see refund request with status ""Pending"" in admin refund page","Customer has initiated PayOS refund payment. Payment status is ""PENDING"" or ""PROCESSING"". Return URL is called by PayOS before payment is fully processed"
WF-REFUND-025,RefundPayment,Refund Payment Error - Missing OrderCode,"1. PayOS redirects to application return URL (/api/payment/payos/return) without orderCode parameter (error case)
2. Application backend processes return URL
3. Application detects missing orderCode parameter
4. Application cannot identify which booking/refund request this is for
5. Application redirects customer to frontend error page
6. Customer observes error page appears in browser
7. Review error page content displayed","1. Application backend detects missing orderCode parameter in return URL
2. Application cannot identify which booking/refund request this is for
3. Application redirects customer to /refund-error?message=Missing orderCode
4. Error page displays error message explaining the issue
5. Refund request status is NOT updated (remains ""Pending"")
6. Customer sees error message and cannot proceed
7. Customer may need to contact support or retry with correct link",PayOS return URL is called without orderCode parameter (error scenario - should not happen in normal flow)
,,,,,
Scenario D: Refund Request Validation and Error Handling (10 test cases),,,,,
WF-REFUND-026,RefundValidation,Request Refund - Unauthorized Access,"1. Open browser without logging in
2. Try to navigate to refund request page (/request-refund/{bookingId}) directly via URL
3. Observe page behavior
4. Try to access admin refund page (/admin/refunds) directly via URL
5. Observe page behavior","1. For refund request page: User is redirected to login page or sees error message: ""Vui lòng đăng nhập để xem thông tin booking""
2. For admin refund page: User is redirected to login page or sees 403 Forbidden error
3. User cannot access refund pages without proper authentication
4. User must login with appropriate role (Tenant for refund request, Admin for admin page)",User is NOT logged in. User tries to access refund pages directly
WF-REFUND-027,RefundValidation,Request Refund - Booking Not Owned by User,"1. Open browser and login the system with Tenant role (User A)
2. Try to navigate to refund request page for booking owned by another user (User B) via URL (/request-refund/{bookingId})
3. Observe page behavior
4. Review error message displayed","1. Page loads but shows error message: ""Bạn không có quyền truy cập booking này""
2. Error message appears in red box
3. Link ""Quay lại danh sách booking"" appears
4. After 3 seconds, user is automatically redirected to home page (/)
5. User cannot access refund request for booking they don't own",User A is logged in as Tenant role. Booking exists but is owned by User B (different customerId)
WF-REFUND-028,RefundValidation,Request Refund - Booking Not Found,"1. Open browser and login the system with Tenant role
2. Try to navigate to refund request page with invalid booking ID (/request-refund/99999)
3. Observe page behavior
4. Review error message displayed","1. Page shows error message: ""Không tìm thấy thông tin booking"" or ""Không thể tải thông tin booking. Vui lòng thử lại sau.""
2. Error message appears in red box
3. Link ""Quay lại danh sách booking"" appears
4. User cannot proceed with refund request",User is logged in as Tenant role. Booking with ID 99999 does NOT exist in database
WF-REFUND-029,RefundValidation,Request Refund - Booking Status Invalid,"1. Open browser and login the system with Tenant role
2. Navigate to refund request page for booking with invalid status (e.g., status = ""Pending"" and cannot be refunded)
3. Observe page behavior
4. Review error message displayed","1. Page shows error message explaining why refund cannot be requested
2. Error message appears in red box with specific reason (e.g., ""Booking đang ở trạng thái \""Pending\"" không thể hoàn tiền."")
3. Form fields may be disabled or hidden
4. ""Gửi yêu cầu hoàn tiền"" button may be disabled or hidden
5. User cannot submit refund request","User is logged in as Tenant role. Booking exists but has invalid status for refund (e.g., ""Pending"" without payment, or outside time limits)"
WF-REFUND-030,RefundValidation,Submit Refund Request - Network Error,"1. On refund request page with valid booking
2. Fill in all required bank information fields
3. Disconnect internet connection
4. Click ""Gửi yêu cầu hoàn tiền"" button
5. Observe error message displayed","1. Button shows ""Đang xử lý..."" with spinner
2. After timeout, error message appears in red box: ""Đã có lỗi xảy ra khi gửi yêu cầu hoàn tiền. Vui lòng thử lại sau.""
3. Form fields remain filled (user doesn't lose data)
4. Button returns to normal state (""Gửi yêu cầu hoàn tiền"")
5. User can retry submission after fixing network issue",User is on refund request page. All form fields are filled. Network connection is lost
WF-REFUND-031,RefundValidation,Submit Refund Request - Server Error,"1. On refund request page with valid booking
2. Fill in all required bank information fields
3. Click ""Gửi yêu cầu hoàn tiền"" button
4. Simulate server error (500 Internal Server Error)
5. Observe error message displayed","1. Button shows ""Đang xử lý..."" with spinner
2. Error message appears in red box with server error message or generic message: ""Đã có lỗi xảy ra khi gửi yêu cầu hoàn tiền. Vui lòng thử lại sau.""
3. If backend returns structured error, specific error message is displayed
4. Form fields remain filled
5. Button returns to normal state
6. User can retry submission",User is on refund request page. All form fields are filled. Backend returns 500 error
WF-REFUND-032,RefundValidation,Admin Process Refund - Unauthorized Access,"1. Open browser and login the system with Tenant role (NOT Admin)
2. Try to navigate to admin refund page (/admin/refunds) directly via URL
3. Observe page behavior
4. Review error message displayed","1. User is redirected to login page or sees 403 Forbidden error
2. Error message may appear: ""You do not have permission to access this resource"" or similar
3. User cannot access admin refund page
4. User must login with Admin role to access this page",User is logged in as Tenant role (NOT Admin). User tries to access admin refund page
WF-REFUND-033,RefundValidation,Admin Process Refund - Refund Request Not Found,"1. Open browser and login the system with Admin role
2. On admin refund page, try to process refund for non-existent refund request (simulate by deleting request before processing)
3. Observe error message displayed","1. Error alert appears: ""Không tìm thấy thông tin yêu cầu hoàn tiền. Vui lòng thử lại.""
2. Modal remains open or closes
3. Table does NOT update
4. Refund request status does NOT change
5. User can retry or refresh page",User is on admin refund page. Refund request is deleted or does not exist when admin tries to process it
WF-REFUND-034,RefundValidation,Admin Process Refund - Already Processed,"1. Open browser and login the system with Admin role
2. On admin refund page, find a refund request that has already been processed (status = ""Completed"" or ""Refunded"")
3. Try to process refund again (if buttons are visible)
4. Observe error message displayed","1. Action buttons are NOT visible for processed requests (shows ""Đã xử lý xong"" text instead)
2. If buttons are somehow visible and clicked, error message appears: ""Booking has already been refunded.""
3. Refund request status does NOT change
4. Table does NOT update
5. User cannot process refund again","User is on admin refund page. Refund request exists with status ""Completed"" or ""Refunded"""
WF-REFUND-035,RefundValidation,Admin Reject Refund - Missing Reason Validation,"1. On admin refund page
2. Click ""❌ Từ chối"" button for a refund request
3. Rejection modal appears
4. Leave ""Lý do từ chối"" textarea empty
5. Try to click ""Xác nhận từ chối"" button
6. Observe button state
7. Try to submit via Enter key
8. Observe behavior","1. ""Xác nhận từ chối"" button is disabled (grayed out, not clickable)
2. Button shows ""not-allowed"" cursor on hover
3. Clicking button does nothing (no action triggered)
4. Pressing Enter key does nothing
5. Browser may show validation message if textarea has ""required"" attribute
6. User must enter reason before submitting",User is on admin refund page. Rejection modal is open. Textarea is empty
